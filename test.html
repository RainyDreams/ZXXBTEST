<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI聊天助手</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    // 配置Tailwind自定义颜色和字体
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            neutral: '#F3F4F6',
            dark: '#1F2937',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-balance {
        text-wrap: balance;
      }
      .chat-bubble-left {
        border-radius: 18px 18px 18px 0;
      }
      .chat-bubble-right {
        border-radius: 18px 18px 0 18px;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans text-dark min-h-screen flex flex-col">
  <!-- 顶部导航 -->
  <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center">
          <i class="fa fa-comments text-primary text-2xl mr-2"></i>
          <h1 class="text-xl font-semibold text-gray-800">AI聊天助手</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
            <i class="fa fa-moon-o text-gray-600"></i>
          </button>
          <button id="clear-chat" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
            <i class="fa fa-trash-o text-gray-600"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="flex-1 flex flex-col max-w-5xl w-full mx-auto w-full px-4 sm:px-6 lg:px-8 py-4">
    <!-- 聊天记录区域 -->
    <div id="chat-container" class="flex-1 overflow-y-auto scrollbar-hide mb-4 space-y-6">
      <!-- 欢迎消息 -->
      <div class="flex items-start">
        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-primary flex items-center justify-center text-white">
          <i class="fa fa-robot"></i>
        </div>
        <div class="ml-3 max-w-[85%]">
          <div class="bg-white p-4 shadow-sm chat-bubble-left">
            <p class="text-gray-700 text-balance">你好！我是AI助手，有什么可以帮助你的吗？</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 输入区域 -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-3">
      <form id="chat-form" class="flex flex-col">
        <textarea 
          id="user-input" 
          placeholder="输入你的问题..." 
          class="flex-1 w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none resize-none transition-all"
          rows="1"
        ></textarea>
        
        <div class="flex justify-between items-center mt-2">
          <div class="flex space-x-2">
            <button type="button" id="upload-image" class="p-2 rounded-full hover:bg-gray-100 transition-colors text-gray-600">
              <i class="fa fa-image"></i>
            </button>
            <button type="button" id="upload-audio" class="p-2 rounded-full hover:bg-gray-100 transition-colors text-gray-600">
              <i class="fa fa-microphone"></i>
            </button>
          </div>
          
          <button 
            type="submit" 
            id="send-button"
            class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:hover:scale-100 disabled:cursor-not-allowed"
          >
            <i class="fa fa-paper-plane mr-1"></i> 发送
          </button>
        </div>
      </form>
    </div>
    
    <!-- 状态信息 -->
    <div id="status-info" class="text-center text-gray-500 text-sm mt-4 hidden">
      <span id="status-text">AI正在思考...</span>
      <button id="stop-generation" class="text-primary ml-2 hover:underline hidden">
        停止生成
      </button>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white border-t border-gray-200 py-4">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
      <p class="text-center text-gray-500 text-sm">
        内容由AI生成，请仔细甄别 | 零本智协大模型提供支持
      </p>
    </div>
  </footer>

  <script>
    // DOM元素
    const chatContainer = document.getElementById('chat-container');
    const chatForm = document.getElementById('chat-form');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const statusInfo = document.getElementById('status-info');
    const statusText = document.getElementById('status-text');
    const stopGeneration = document.getElementById('stop-generation');
    const clearChatButton = document.getElementById('clear-chat');
    const themeToggle = document.getElementById('theme-toggle');
    
    // 状态变量
    let isGenerating = false;
    let abortController = null;
    let isDarkMode = false;
    
    // 自动调整文本框高度
    userInput.addEventListener('input', () => {
      userInput.style.height = 'auto';
      // 限制最大高度为120px
      userInput.style.height = Math.min(userInput.scrollHeight, 120) + 'px';
    });
    
    // 发送消息
    chatForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const message = userInput.value.trim();
      
      if (!message || isGenerating) return;
      
      // 添加用户消息到聊天记录
      addMessageToChat(message, 'user');
      
      // 清空输入框并重置高度
      userInput.value = '';
      userInput.style.height = 'auto';
      
      // 开始生成AI回复
      await generateAIResponse(message);
    });
    
    // 添加消息到聊天记录
    function addMessageToChat(content, role) {
      const isUser = role === 'user';
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `flex items-start ${isUser ? 'justify-end' : ''}`;
      
      const avatarDiv = document.createElement('div');
      avatarDiv.className = `flex-shrink-0 h-10 w-10 rounded-full ${isUser ? 'bg-gray-300' : 'bg-primary'} flex items-center justify-center text-white`;
      avatarDiv.innerHTML = isUser ? '<i class="fa fa-user"></i>' : '<i class="fa fa-robot"></i>';
      
      const contentDiv = document.createElement('div');
      contentDiv.className = `ml-3 max-w-[85%] ${isUser ? 'mr-3' : ''}`;
      
      const bubbleDiv = document.createElement('div');
      bubbleDiv.className = `p-4 shadow-sm ${isUser ? 'bg-primary text-white chat-bubble-right' : 'bg-white chat-bubble-left'}`;
      bubbleDiv.id = isUser ? '' : `ai-message-${Date.now()}`;
      
      // 如果是用户消息，直接显示
      if (isUser) {
        bubbleDiv.textContent = content;
      } else {
        bubbleDiv.textContent = ''; // AI消息初始为空，后续流式填充
      }
      
      contentDiv.appendChild(bubbleDiv);
      
      if (isUser) {
        messageDiv.appendChild(contentDiv);
        messageDiv.appendChild(avatarDiv);
      } else {
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
      }
      
      chatContainer.appendChild(messageDiv);
      scrollToBottom();
      
      return isUser ? null : bubbleDiv;
    }
    
    // 生成AI回复（模拟流式输出）
    async function generateAIResponse(prompt) {
      isGenerating = true;
      sendButton.disabled = true;
      statusInfo.classList.remove('hidden');
      stopGeneration.classList.remove('hidden');
      
      // 创建AI消息容器
      const aiMessageElement = addMessageToChat('', 'assistant');
      
      // 模拟AI思考延迟
      statusText.textContent = 'AI正在思考...';
      await new Promise(resolve => setTimeout(resolve, 800));
      
      // 模拟流式响应
      abortController = new AbortController();
      const signal = abortController.signal;
      
      // 这里应该是真实的API调用，这里用模拟数据
      const mockResponses = [
        "你好！我是AI助手，很高兴为你服务。",
        "根据你的问题，我可以提供一些相关信息和建议。",
        "首先，我们需要考虑几个关键点：",
        "1. 问题的核心是什么？",
        "2. 有哪些可能的解决方案？",
        "3. 每种方案的优缺点是什么？",
        "如果你能提供更多细节，我可以给出更具体的回答。",
        "希望这些信息对你有帮助！如果还有其他问题，请随时问我。"
      ];
      
      statusText.textContent = 'AI正在回复...';
      
      try {
        for (const responsePart of mockResponses) {
          if (signal.aborted) break;
          
          // 逐字显示效果
          for (const char of responsePart) {
            if (signal.aborted) break;
            aiMessageElement.textContent += char;
            scrollToBottom();
            await new Promise(resolve => setTimeout(resolve, 30));
          }
          aiMessageElement.textContent += ' ';
          await new Promise(resolve => setTimeout(resolve, 100));
        }
      } catch (error) {
        if (!signal.aborted) {
          aiMessageElement.textContent += '\n\n⚠️ 生成过程中出现错误，请重试。';
        }
      } finally {
        // 重置状态
        isGenerating = false;
        sendButton.disabled = false;
        statusInfo.classList.add('hidden');
        stopGeneration.classList.add('hidden');
        abortController = null;
      }
    }
    
    // 停止生成
    stopGeneration.addEventListener('click', () => {
      if (abortController) {
        abortController.abort();
        statusText.textContent = '已停止生成';
        stopGeneration.classList.add('hidden');
      }
    });
    
    // 清空聊天记录
    clearChatButton.addEventListener('click', () => {
      if (confirm('确定要清空所有聊天记录吗？')) {
        // 保留欢迎消息
        const welcomeMessage = chatContainer.firstChild;
        chatContainer.innerHTML = '';
        chatContainer.appendChild(welcomeMessage);
      }
    });
    
    // 切换主题
    themeToggle.addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('bg-gray-900');
      document.body.classList.toggle('bg-gray-50');
      document.body.classList.toggle('text-white');
      document.body.classList.toggle('text-dark');
      
      // 更新图标
      const icon = themeToggle.querySelector('i');
      if (isDarkMode) {
        icon.classList.remove('fa-moon-o');
        icon.classList.add('fa-sun-o');
      } else {
        icon.classList.remove('fa-sun-o');
        icon.classList.add('fa-moon-o');
      }
    });
    
    // 滚动到底部
    function scrollToBottom() {
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
    
    // 支持Enter发送，Shift+Enter换行
    userInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        chatForm.dispatchEvent(new Event('submit'));
      }
    });
  </script>
</body>
</html>
